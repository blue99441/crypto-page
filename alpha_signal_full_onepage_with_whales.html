<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Alpha Signal â€” ä¸»åŠ›è¨Šè™ŸåŠ å¼·ç‰ˆï¼ˆå–®é ï¼‰</title>
<style>
  :root{
    --bg:#0b1220;--card:#0f172a;--text:#e5e7eb;--muted:#9ca3af;--accent:#22d3ee;
    --good:#34d399;--bad:#f87171;--warn:#fbbf24;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto}
  header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,rgba(11,18,32,.95),rgba(11,18,32,.7));backdrop-filter: blur(6px);}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  input,button,select{background:#0b1730;color:var(--text);border:1px solid #26324b;border-radius:10px;padding:10px 12px}
  button{background:linear-gradient(90deg,#22d3ee33,#22d3ee55);border-color:#22d3ee55;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  .mini{height:110px;border:1px solid #1d2942;border-radius:12px;padding:6px;background:linear-gradient(180deg,#0d162d,#0c1427)}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin:14px 0}
  .card{background:var(--card);border:1px solid #1d2942;border-radius:14px;padding:14px}
  .title{font-weight:700;margin:0 0 6px}
  .muted{color:var(--muted);font-size:13px}
  .k{height:100%;width:100%}
  .signal{font-weight:800}
  .up{color:var(--good)} .down{color:var(--bad)} .warn{color:var(--warn)}
  .hint{font-size:13px;color:#93c5fd}
  .flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .mono{font-family:ui-monospace,Consolas,Menlo,monospace}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <div style="font-weight:800;font-size:18px">ğŸ“ˆ Alpha Signal â€” ä¸»åŠ›è¨Šè™Ÿ</div>
      <div class="flex">
        äº¤æ˜“å°ï¼š<input id="symbol" value="BTCUSDT" style="width:120px" />
        <button id="refresh">æ›´æ–°</button>
        <label class="muted"><input id="auto" type="checkbox"/> è‡ªå‹•åˆ·æ–°(30s)</label>
      </div>
    </div>
    <div class="mini"><canvas id="spark"></canvas></div>
  </div>
</header>

<main class="wrap">
  <div class="cards">
    <section class="card">
      <h3 class="title">å³æ™‚æ¦‚è¦½</h3>
      <div id="overview" class="mono">--</div>
      <div class="muted" id="stamp">--</div>
    </section>

    <section class="card">
      <h3 class="title">ä¸»åŠ›è¨Šè™Ÿ</h3>
      <div id="whales" class="signal">--</div>
      <div class="muted" id="whales-desc">Taker å¤šç©ºæ¯”ã€OI è®ŠåŒ–ã€èˆ‡ 1h åƒ¹æ ¼å‹•èƒ½ç¶œåˆåˆ¤è®€ã€‚</div>
    </section>

    <section class="card">
      <h3 class="title">è³‡é‡‘è²»èˆ‡åŸºå·®</h3>
      <div id="funding" class="mono">--</div>
      <div class="muted">ä¾†æºï¼šBinance Futures premiumIndex / fundingRate</div>
    </section>

    <section class="card">
      <h3 class="title">æœªå¹³å€‰é‡ OI</h3>
      <div id="oi" class="mono">--</div>
      <div class="muted">è¿‘ 1 å°æ™‚ OI è®ŠåŒ–ï¼Œçµåˆåƒ¹æ ¼å‹•å‘åˆ¤æ–·æ–°å¢/å›è£œã€‚</div>
    </section>
  </div>

  <section class="card">
    <h3 class="title">æ–¹æ³•ï¼ˆå¿«é€Ÿï¼‰</h3>
    <ol class="muted">
      <li>taker å¤šç©ºæ¯”ï¼ˆè¿‘ 1hï¼‰ï¼š&gt;1.05 åå¤šã€&lt;0.95 åç©ºã€‚</li>
      <li>OI èˆ‡åƒ¹æ ¼åˆ¤è®€ï¼š
        <span class="mono">OIâ†‘ åƒ¹â†‘ = å¤šæ–°å¢</span>ã€
        <span class="mono">OIâ†‘ åƒ¹â†“ = ç©ºæ–°å¢</span>ã€
        <span class="mono">OIâ†“ åƒ¹â†‘ = ç©ºå›è£œ</span>ã€
        <span class="mono">OIâ†“ åƒ¹â†“ = å¤šå›è£œ</span>ã€‚
      </li>
      <li>è³‡é‡‘è²»èˆ‡åŸºå·®åšç‚ºé †/é€†é¢¨åƒè€ƒã€‚</li>
    </ol>
  </section>
</main>

<script>
const $ = s=>document.querySelector(s);
const fmt=(n, d=2)=>Number(n).toLocaleString('en-US',{maximumFractionDigits:d});
let timer=null;

async function fetchJson(url){
  const r = await fetch(url);
  if(!r.ok) throw new Error(await r.text());
  return r.json();
}

async function load(){
  try{
    const sym = $('#symbol').value.trim().toUpperCase();
    $('#refresh').disabled = true;

    // è¿‘ 4 å°æ™‚ 5m K ç·š (PERPETUAL)
    const k = await fetchJson(`https://fapi.binance.com/fapi/v1/continuousKlines?pair=${sym}&contractType=PERPETUAL&interval=5m&limit=48`);
    const closes = k.map(row=>Number(row[4]));
    const tFirst = k[0][0], tLast = k[k.length-1][0];
    const p0 = Number(k[0][1]); const p1 = Number(k[k.length-1][4]);
    const pChange1h = (Number(k[k.length-1][4])-Number(k[k.length-13][4]))/Number(k[k.length-13][4])*100;

    drawSpark(closes);

    // 24h ticker + premiumIndex + funding
    const [tick, prem, lastFund] = await Promise.all([
      fetchJson(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${sym}`),
      fetchJson(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${sym}`),
      fetchJson(`https://fapi.binance.com/fapi/v1/fundingRate?symbol=${sym}&limit=1`)
    ]);

    const price = Number(prem.markPrice ?? tick.lastPrice);
    const chg = Number(tick.priceChangePercent);
    $('#overview').innerHTML = `åƒ¹æ ¼ ${fmt(price)} ï½œ24h ${chg>=0?'<span class="up">â–²':''}${fmt(chg)}%${chg>=0?'</span>':'<span class="down">â–¼</span>'} ï½œ æˆäº¤é¡ $${fmt(tick.quoteVolume,0)}`;
    $('#funding').innerText = `æ¨™è¨˜åƒ¹ ${fmt(prem.markPrice)} ï½œåŸºå·® ${fmt(prem.lastFundingRate*100,4)} bp ï½œä¸Šæ¬¡è³‡é‡‘è²» ${fmt(lastFund[0]?.fundingRate*100,4)}%`;
    $('#stamp').innerText = `æ›´æ–°æ™‚é–“ï¼š${new Date(tLast).toLocaleString()}ï¼ˆè¿‘ä¸€å°æ™‚è®ŠåŒ–ï¼š${fmt(pChange1h,2)}%ï¼‰`;

    // OI æ­·å²èˆ‡ Taker å¤šç©ºæ¯”ï¼ˆè¿‘ 1hï¼‰
    const [oiHist, tlr] = await Promise.all([
      fetchJson(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${sym}&period=5m&limit=12`),
      fetchJson(`https://fapi.binance.com/futures/data/takerlongshortRatio?symbol=${sym}&period=5m&limit=12`)
    ]);

    const oi0 = Number(oiHist[0].sumOpenInterestValue);
    const oi1 = Number(oiHist[oiHist.length-1].sumOpenInterestValue);
    const oiPct = (oi1-oi0)/oi0*100;
    $('#oi').innerText = `ç•¶å‰ OI $${fmt(oi1,0)} ï½œ1h è®ŠåŒ– ${fmt(oiPct,2)}%`;

    // ç¶œåˆä¸»åŠ›è¨Šè™Ÿ
    const r = tlr.map(x=>Number(x.buySellRatio));
    const avg = r.reduce((a,b)=>a+b,0)/r.length;
    let bias = avg>1.05 ? 'åå¤š' : avg<0.95 ? 'åç©º' : 'ä¸­æ€§';
    // OI + åƒ¹æ ¼å››è±¡é™
    let quad='';
    if(oiPct>0 && pChange1h>0) quad='å¤šå–®æ–°å¢ï¼ˆé †å‹¢ï¼‰';
    else if(oiPct>0 && pChange1h<0) quad='ç©ºå–®æ–°å¢ï¼ˆé€†åƒ¹ä¸Šå‡ï¼‰';
    else if(oiPct<0 && pChange1h>0) quad='ç©ºå–®å›è£œï¼ˆæ“ å£“ï¼‰';
    else if(oiPct<0 && pChange1h<0) quad='å¤šå–®å›è£œï¼ˆäº†çµï¼‰';
    else quad='è®Šå‹•æœ‰é™';

    let level = 0;
    if(bias==='åå¤š') level+=1;
    if(bias==='åç©º') level-=1;
    if(quad.includes('å¤šå–®æ–°å¢')) level+=2;
    if(quad.includes('ç©ºå–®æ–°å¢')) level-=2;
    if(quad.includes('å›è£œ')) level+= (quad.includes('ç©ºå–®å›è£œ')?1:-1);

    const label = level>=2 ? 'ä¸»åŠ›å¤šæ–¹é€²å ´' : level<=-2 ? 'ä¸»åŠ›ç©ºæ–¹é€²å ´' : level>0 ? 'å¤šæ–¹å„ªå‹¢' : level<0 ? 'ç©ºæ–¹å„ªå‹¢' : 'è§€æœ›';

    $('#whales').innerHTML = `${label}ã€€<span class="${level>=0?'up':'down'}">Taker æ¯” ${fmt(avg,2)}</span> ï½œ <span class="${oiPct>=0?'up':'down'}">OI ${fmt(oiPct,2)}%</span> ï½œ <span class="${pChange1h>=0?'up':'down'}">1h åƒ¹ ${fmt(pChange1h,2)}%</span>`;
    $('#whales-desc').innerText = `${bias}ï¼›åˆ¤è®€ï¼š${quad}`;

  }catch(e){
    console.error(e);
    alert('å–å¾—è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š'+e.message);
  }finally{
    $('#refresh').disabled = false;
  }
}

function drawSpark(data){
  const canvas = $('#spark');
  const ctx = canvas.getContext('2d');
  const W = canvas.parentElement.clientWidth - 12;
  const H = canvas.parentElement.clientHeight - 12;
  canvas.width = W; canvas.height = H;
  ctx.clearRect(0,0,W,H);
  const min = Math.min(...data), max = Math.max(...data);
  const n = data.length;
  const pad = 8;
  ctx.lineWidth = 2;
  ctx.strokeStyle = '#60a5fa';
  ctx.beginPath();
  data.forEach((v,i)=>{
    const x = pad + i*(W-2*pad)/(n-1);
    const y = H - pad - ( (v-min)/(max-min||1) )*(H-2*pad);
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.stroke();
}

$('#refresh').addEventListener('click', load);
$('#auto').addEventListener('change', e=>{
  if(e.target.checked){
    timer = setInterval(load, 30000);
  }else{
    clearInterval(timer);
  }
});
window.addEventListener('load', load);
</script>
</body>
</html>
