<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Leverage PnL Calculator</title>
<style>
  :root{
    --bg:#0b0f1a; --panel:#0f1530; --text:#eaf1ff; --muted:#9aa8c7;
    --accent:#5ee1ff; --accent2:#7cffb7;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 80% -10%, rgba(94,225,255,.12), transparent 60%),
                 radial-gradient(900px 600px at -20% 110%, rgba(124,255,183,.10), transparent 60%), var(--bg);
       color:var(--text);font-family:system-ui,-apple-system,"Noto Sans TC","Segoe UI",Roboto,Arial;padding:16px}
  .shell{max-width:1200px;margin:auto;display:grid;grid-template-columns:1fr 1.2fr;gap:16px}
  .sticky{position:sticky;top:12px;align-self:start}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.00));border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.35)}
  .pad{padding:16px}
  h1{margin:0 0 6px;font-size:24px} .sub{margin:0 0 14px;color:var(--muted);font-size:13px}
  .tabs{display:flex;gap:8px;margin-bottom:12px}
  .tab{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.12);cursor:pointer;color:var(--muted)}
  .tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#041923;border:none}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .col-3{grid-column:span 3} .col-4{grid-column:span 4} .col-6{grid-column:span 6} .col-12{grid-column:span 12}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input,select{width:100%;padding:11px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0c1331;color:var(--text);font-size:16px;outline:none}
  button{appearance:none;border:none;padding:12px 14px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#06202c;font-weight:800;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,.12);color:var(--text);font-weight:600}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .pill{padding:4px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid rgba(255,255,255,.2)}
  .pill.long{color:#0cd68a;background:rgba(12,214,138,.12);border-color:rgba(12,214,138,.35)}
  .pill.short{color:#ff9d9d;background:rgba(255,107,107,.12);border-color:rgba(255,107,107,.35)}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  .kv{display:flex;justify-content:space-between;gap:8px;padding:10px;border-bottom:1px dashed rgba(255,255,255,.08)}
  .resultWrap{display:flex;flex-direction:column;gap:12px}
  .resultTitle{margin:0 0 6px;font-size:16px;font-weight:800}
  .muted{color:var(--muted);font-size:12px}
  @media (max-width:900px){.shell{grid-template-columns:1fr} .sticky{position:relative}}
</style>
</head>
<body>
  <div class="shell">
    <!-- LEFT: Sticky Results -->
    <div class="sticky">
      <div class="card pad">
        <h1>å€‰ä½åˆ©æ½¤è¨ˆç®—å™¨</h1>
        <p class="sub">å·¦å´å³æ™‚é¡¯ç¤ºçµæœ å³å´å¡«åƒæ•¸</p>
        <div class="resultWrap">
          <div>
            <div class="resultTitle">åˆ©æ½¤è©¦ç®—ï¼ˆçµ¦ç›®æ¨™åƒ¹ï¼‰</div>
            <div id="res" style="display:none">
              <div class="kv"><span>åç¾©å€‰ä½</span><b id="notional" class="mono">â€”</b></div>
              <div class="kv"><span>æŒå€‰æ•¸é‡ï¼ˆå¹£ï¼‰</span><b id="qty" class="mono">â€”</b></div>
              <div class="kv"><span>åƒ¹æ ¼è®ŠåŒ–</span><b id="delta" class="mono">â€”</b></div>
              <div class="kv"><span>æ¯›åˆ© / æ¯›æ</span><b id="pnlGross" class="mono">â€”</b></div>
              <div class="kv"><span>é ä¼°æ‰‹çºŒè²»ï¼ˆé›™é‚Šï¼‰</span><b id="feeUsd" class="mono">â€”</b></div>
              <div class="kv"><span>æ·¨åˆ© / æ·¨æ</span><b id="pnlNet" class="mono">â€”</b></div>
              <div class="kv"><span>åƒ¹æ ¼æ¼²è·Œå¹…</span><b id="movePct" class="mono">â€”</b></div>
              <div class="kv"><span>æ§“æ¡¿å¾Œ ROE</span><b id="roe" class="mono">â€”</b></div>
              <div class="kv"><span>ç›ˆè™§æ¯”ï¼ˆæ·¨ï¼‰</span><b id="rr" class="mono">â€”</b></div>
              <div class="kv"><span>æ‘˜è¦</span><b id="summary" class="mono">â€”</b></div>
            </div>
            <div class="muted" id="resHint">è¼¸å…¥åƒæ•¸å¾Œæœƒåœ¨é€™è£¡é¡¯ç¤ºçµæœ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Inputs -->
    <div class="card pad">
      <div class="tabs">
        <div id="tabForward" class="tab active">åˆ©æ½¤è©¦ç®—</div>
      </div>

      <div id="forward">
        <div class="grid">
          <div class="col-3"><label>æ–¹å‘</label><select id="side"><option value="long">åšå¤š Long ğŸ“ˆ</option><option value="short">åšç©º Short ğŸ“‰</option></select></div>
          <div class="col-3"><label>æ§“æ¡¿ï¼ˆXï¼‰</label><input id="lev" type="number" min="1" step="1" /></div>
          <div class="col-3"><label>æœ¬é‡‘ï¼ˆUSDTï¼‰</label><input id="capital" type="number" min="1" step="0.01" /></div>
          <div class="col-3"><label>æ‰‹çºŒè²»ç‡ï¼ˆå–®é‚Šï¼Œ%ï¼‰</label><input id="fee" type="number" min="0" step="0.001" /></div>
          <div class="col-4"><label>é€²å ´åƒ¹</label><input id="entry" type="number" min="0.00000001" step="0.0001" /></div>
          <div class="col-4"><label>ç›®æ¨™åƒ¹</label><input id="target" type="number" min="0.00000001" step="0.0001" /></div>
          <div class="col-4"><label>å¹£ç¨®ï¼ˆé¡¯ç¤ºç”¨ï¼‰</label><input id="symbol" placeholder="ä¾‹å¦‚ ETH" /></div>
        </div>

        <div class="row" style="margin-top:12px">
          <button id="calc">è¨ˆç®—</button>
          <button class="ghost" id="copy">è¤‡è£½çµæœ</button>
        </div>
      </div>

      <p class="muted" style="margin-top:10px">æ‰‹çºŒè²»è¼¸å…¥ç‚ºã€Œå–®é‚Š%ã€ï¼Œç¨‹å¼ä»¥é›™é‚Šä¼°ç®—ã€‚</p>
    </div>
  </div>

<script>
(function(){
  const $ = sel=>document.querySelector(sel);
  const fmtUsd = v => 'US$ ' + (Math.round(v*100)/100).toLocaleString();
  const fmtNum = v => Number(v).toLocaleString(undefined,{maximumFractionDigits:8});
  const pct = v => (Math.round(v*1000)/10).toLocaleString() + "%";
  const sideEl=$("#side"), levEl=$("#lev"), capEl=$("#capital"), feeEl=$("#fee"), entryEl=$("#entry"), targetEl=$("#target"), symEl=$("#symbol");
  const res=$("#res"), resHint=$("#resHint"), notionalEl=$("#notional"), qtyEl=$("#qty"), deltaEl=$("#delta"), pnlGrossEl=$("#pnlGross"), feeUsdEl=$("#feeUsd"), pnlNetEl=$("#pnlNet"), movePctEl=$("#movePct"), roeEl=$("#roe"), rrEl=$("#rr"), summaryEl=$("#summary");

  function calcForward(){
    const side = sideEl.value; const x = Number(levEl.value||0); const cap = Number(capEl.value||0);
    const feePct = Number(feeEl.value||0)/100;
    const entry = Number(entryEl.value||0); const target = Number(targetEl.value||0);
    if(!(entry>0 && target>0 && x>0 && cap>0)) return;
    const notional = cap * x;
    const qty = notional / entry;
    const priceDiff = (side==='long') ? (target - entry) : (entry - target);
    const pnlGross = priceDiff * qty;
    const feeUsd = notional * feePct * 2;
    const pnlNet = pnlGross - feeUsd;
    const move = (target-entry)/entry;
    const roe = cap>0 ? (pnlNet/cap) : 0;

    notionalEl.textContent = fmtUsd(notional);
    qtyEl.textContent = fmtNum(qty);
    deltaEl.textContent = fmtNum(Math.abs(target-entry));
    pnlGrossEl.textContent = fmtUsd(pnlGross);
    feeUsdEl.textContent = fmtUsd(feeUsd);
    pnlNetEl.textContent = fmtUsd(pnlNet);
    movePctEl.textContent = pct(Math.abs(move));
    roeEl.textContent = pct(roe);
    rrEl.textContent = (pnlNet/cap).toFixed(2)+"x";
    const sym = (symEl.value||'').trim().toUpperCase();
    summaryEl.textContent = `${sym? sym+' ':''}${side.toUpperCase()} @ ${fmtNum(entry)} â†’ ${fmtNum(target)} ï½œ ${pnlNet>=0?'åˆ©æ½¤':'æå¤±'} ${fmtUsd(Math.abs(pnlNet))} ï½œ ROE ${pct(roe)}`;
    res.style.display='block'; resHint.style.display='none';
  }
  $("#calc").onclick = calcForward;
  $("#copy").onclick = ()=>{
    if(res.style.display==='none') return alert('è«‹å…ˆè¨ˆç®—');
    navigator.clipboard.writeText(summaryEl.textContent);
    $("#copy").textContent='å·²è¤‡è£½'; setTimeout(()=>$("#copy").textContent='è¤‡è£½çµæœ',900);
  };
})();</script>
</body>
</html>